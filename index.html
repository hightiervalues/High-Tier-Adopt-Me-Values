<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>High Tier Adopt Me Values</title>

  <!-- Google Fonts for nicer font options -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Poppins:wght@400;600;700&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- Top Navigation -->
  <header class="topbar">
    <div class="logo">HighTier<span>Values</span></div>

    <nav class="nav">
      <a href="index.html" class="nav-link active">Pets</a>
      <a href="#trade" class="nav-link">Trade Calc</a>
      <a href="profile.html" class="nav-link">Profile</a>

      <!-- Theme + Font controls -->
      <div class="toolbar">
        <button id="themeToggle" class="icon-button" type="button" title="Toggle light / dark">
          ðŸŒ™
        </button>

        <select id="fontSelect" class="font-select" title="Choose font">
          <option value="inter">Inter</option>
          <option value="poppins">Poppins</option>
          <option value="fredoka">Fredoka</option>
        </select>
      </div>

      <!-- When LOGGED OUT -->
      <div id="authButtons" class="auth-buttons">
        <a href="signup.html" class="btn-primary">Sign Up</a>
        <a href="login.html" class="btn-secondary">Log In</a>
      </div>

      <!-- When LOGGED IN -->
      <div id="accountArea" class="account-area">
        <div id="accountAvatar" class="avatar-circle"></div>
        <div class="account-text">
          <div id="accountSummary" class="account-summary"></div>
          <a href="profile.html" class="account-link">View Profile</a>
        </div>
        <button id="logoutHeaderBtn" class="btn-secondary btn-small" type="button">
          Log out
        </button>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    <section class="filters">
      <input id="searchInput" type="text" placeholder="Search pets..." class="search-box" />

      <select id="tierFilter" class="filter-select">
        <option value="">All Tiers</option>
      </select>

      <select id="rarityFilter" class="filter-select">
        <option value="">All Rarities</option>
      </select>
    </section>

    <section id="tierTabs" class="tier-tabs"></section>

    <section id="petGrid" class="pet-grid"></section>
  </main>

  <!-- Modal -->
  <div id="petModal" class="modal hidden">
    <div class="modal-content" id="modalContent"></div>
    <button id="closeModal" class="modal-close">Ã—</button>
  </div>

  <!-- Trade Calculator -->
  <section id="trade" class="trade-section">
    <h2>Trade Calculator</h2>

    <div class="trade-area">
      <div>
        <h3>You Give</h3>
        <div id="giveList" class="trade-list"></div>
        <button id="clearGive" class="btn-secondary">Clear</button>
      </div>

      <div>
        <h3>You Get</h3>
        <div id="getList" class="trade-list"></div>
        <button id="clearGet" class="btn-secondary">Clear</button>
      </div>
    </div>

    <button id="evaluateBtn" class="btn-primary">Evaluate Trade</button>
    <p id="tradeResult" class="trade-result"></p>
  </section>

  <!-- Main app logic -->
  <script src="app.js"></script>

  <!-- Theme, font, header auth logic -->
  <script>
    (function() {
      function getCurrentUser() {
        try {
          return JSON.parse(localStorage.getItem("currentUser"));
        } catch (e) {
          return null;
        }
      }

      function formatJoinDate(dateIso) {
        if (!dateIso) return "";
        const d = new Date(dateIso);
        if (isNaN(d)) return "";
        return d.toLocaleDateString(undefined, {
          year: "numeric",
          month: "short",
          day: "numeric"
        });
      }

      function firstLetter(name, email) {
        const source = name || email || "";
        return source.trim().charAt(0).toUpperCase() || "?";
      }

      function applyTheme(theme) {
        const body = document.body;
        if (theme === "dark") {
          body.classList.add("dark-theme");
        } else {
          body.classList.remove("dark-theme");
        }
        localStorage.setItem("htv_theme", theme);
      }

      function applyFont(fontKey) {
        const root = document.documentElement;
        let stack = '"Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif';
        if (fontKey === "poppins") {
          stack = '"Poppins", system-ui, -apple-system, BlinkMacSystemFont, sans-serif';
        } else if (fontKey === "fredoka") {
          stack = '"Fredoka", system-ui, -apple-system, BlinkMacSystemFont, sans-serif';
        }
        root.style.setProperty("--font-main", stack);
        localStorage.setItem("htv_font", fontKey);
      }

      document.addEventListener("DOMContentLoaded", function() {
        const authButtons = document.getElementById("authButtons");
        const accountArea = document.getElementById("accountArea");
        const accountSummary = document.getElementById("accountSummary");
        const logoutBtn = document.getElementById("logoutHeaderBtn");
        const avatar = document.getElementById("accountAvatar");
        const themeToggle = document.getElementById("themeToggle");
        const fontSelect = document.getElementById("fontSelect");

        // Theme init
        const savedTheme = localStorage.getItem("htv_theme") || "light";
        applyTheme(savedTheme);
        if (themeToggle) {
          themeToggle.textContent = savedTheme === "dark" ? "â˜€ï¸" : "ðŸŒ™";
          themeToggle.addEventListener("click", () => {
            const current = document.body.classList.contains("dark-theme") ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            applyTheme(next);
            themeToggle.textContent = next === "dark" ? "â˜€ï¸" : "ðŸŒ™";
          });
        }

        // Font init
        const savedFont = localStorage.getItem("htv_font") || "inter";
        applyFont(savedFont);
        if (fontSelect) {
          fontSelect.value = savedFont;
          fontSelect.addEventListener("change", () => {
            applyFont(fontSelect.value);
          });
        }

        // Auth header init
        const user = getCurrentUser();

        if (user) {
          authButtons.style.display = "none";
          accountArea.style.display = "flex";

          const join = formatJoinDate(user.createdAt);
          const name = user.username || user.email;
          accountSummary.textContent =
            join ? `Signed in as ${name} â€¢ Joined: ${join}` : `Signed in as ${name}`;

          // Avatar: prefer profile picture if set, else first letter
          avatar.textContent = "";
          avatar.style.backgroundImage = "";
          if (user.avatarDataUrl) {
            avatar.style.backgroundImage = "url(" + user.avatarDataUrl + ")";
          } else {
            avatar.textContent = firstLetter(user.username, user.email);
          }

          logoutBtn.addEventListener("click", function() {
            localStorage.removeItem("currentUser");
            authButtons.style.display = "flex";
            accountArea.style.display = "none";
            window.location.href = "index.html";
          });
        } else {
          authButtons.style.display = "flex";
          accountArea.style.display = "none";
        }
      });
    })();
  </script>
</body>
</html>
